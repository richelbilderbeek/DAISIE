---
title: "Demo simulating islands"
author: "Luis M. Valente, Albert B. Phillimore, Rampal S. Etienne"
date: "19 May 2015"
output: rmarkdown::html_vignette
vignette: >
 %\VignetteIndexEntry{Demo simulating islands}
 %\VignetteEngine{knitr::rmarkdown}
 %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
 collapse = TRUE,
 comment = "#>"
)
```

# DAISIE – Dynamic Assembly of Island biotas through Speciation, Immigration and Extinction 
                   
Date: 19 May 2015 

Citation: Valente LM, Phillimore AB, Etienne RS (2015) Equilibrium and non-
equilibrium dynamics simultaneously operate in the Galápagos islands. Ecology 
Letters, In press. 

## 3.2 Data table

To load the package:

```{r}
library(DAISIE)
```

The raw dataset is inputted as a table. The Galápagos dataset table can be visualized with: 

```{r}
data(Galapagos_datatable)
knitr::kable(Galapagos_datatable)
```

Each row in the table represents an independent colonisation event. 
The table has four columns:

 * `Clade_name`: name of the independent colonization event. 
 * `Status`: One of the following categories: 
    * `Endemic`: applicable for both anagenetic species and radiations. 
    * `Non_endemic`: If the taxon is not endemic to the island, 
      and the age of colonisation is 
      based on a phylogeny where both island and non-island 
      populations of the species 
      have been sampled. 
    * `Non_endemic_MaxAge`: If the taxon is not endemic to the island, 
      and only an upper bound to the time of colonisation 
      of the island is known. This applies if individuals
      from the island population of the species have not been sampled, 
      but an age of the species is known. 
    * `Endemic&Non_Endemic`: When an endemic clade is present 
      and the mainland ancestor has re-colonized. 
      For remote islands this is expected to be very rare.
 * `Missing_species`: Number of island species that 
   were not sampled for a particular clade (only applicable for radiations). 
 * `Branching_times` – This should be the stem age of the 
   population/species in the case of `Non-endemic`, `Non-endemic_MaxAge` 
   and `Endemic` anagenetic species. For cladogenetic 
   species these should be branching times of the radiation 
   including the stem age of the 
   radiation. Note – if there are species within the radiation that 
   are not found on the island 
   (e.g. back-colonisation) the branching times of these species 
   should be excluded, as the 
   mainland species pool is treated as static. 

## 3.3 Formatting table to run in DAISIE 
 
Before running analyses, the datatable needs to be converted to a DAISIE datalist format 
using the function DAISIE_dataprep. 
 
We will prepare two different datalists based on the Galápagos datatable. In the 1st datalist 
we will treat all taxa as equivalent. We will specify an island age of four million years 
(island_age=4) and a mainland pool size of 1000 (M=1000). 

```{r}
data(Galapagos_datatable) 
      
Galapagos_datalist <- DAISIE_dataprep( 
  datatable = Galapagos_datatable, 
  island_age = 4, 
  M = 1000
)
```
 
In the 2nd datalist we will allow for the Darwin’s finches to form a separate group for which 
rates can be decoupled from those governing the macroevolutionary process in all other 
clades (number_clade_types=2 and list_type2_clades = "Finches"). We will set the proportion 
of Darwin’s finch type species in the mainland pool to be 0.163. (prop_type2_pool=0.163). If 
prop_type2_pool is not specified then by default it is given the value of the proportion of 
the Galapagos lineages that Darwin’s finches represent (1/8=0.125 in this case). 

```{r}
data(Galapagos_datatable) 

Galapagos_datalist_2types <- DAISIE_dataprep( 
  datatable = Galapagos_datatable, 
  island_age = 4, 
  M = 1000, 
  number_clade_types = 2, 
  list_type2_clades = "Finches", 
  prop_type2_pool = 0.163
)
```

The objects `Galapagos_datalist` and `Galapagos_datalist_2types` 
can now be run directly in `DAISIE` functions. 

##  3.5 Simulating islands 
 
The function `DAISIE_sim` allows simulation of DAISIE models and plots the results. The user 
specifies the parameters to be simulated, the number of replicates, the length of the 
simulation (typically the island age), and the number of species in the mainland pool. 
 
When the plot_sims option is set to the default (TRUE) the function will produce a species-
through-time plot showing the accumulation of total, endemic and non-endemic species 
through time, as well as confidence intervals for the total number of species. 
 
### Example 5.1 – Simulating 100 islands with no diversity-dependence, all species sharing the  same parameters, and plotting the results 

```{r} 
pars = c(2.550687345,2.683454548,Inf,0.00933207,1.010073119)

island_replicates = DAISIE_sim( 
  time = 4, 
  M = 1000, 
  pars = pars, 
  replicates = 100
)
```

The object `island_replicates` 
contains the results of the simulation in DAISIE format. 100 islands are stored in the object, 
and each island replicate can be viewed separately. For example 
type `island_replicates[[23]]` to view replicate number 23. 
The element of the list relating to each island contains a table 
with the number of species through time, as well as branching time information for each 
independent colonisation event extant at the end of the simulation.

### Example 5.2 – Simulating 100 islands with diversity-dependence (K’=10), all species sharing the same parameters, and plotting the results 

``` 
pars = c(2.550687345,2.683454548,10,0.00933207,1.010073119) 

island_replicates_K = DAISIE_sim( 
  time = 4, 
  M = 1000, 
  pars = pars, 
  replicates = 100
) 
``` 
 
### Example 5.3 – Simulating 100 islands allowing Darwin’s finches to have a higher rate of cladogenesis: 

```
pars_type1 = c(0.38,0.55,Inf,0.004,1.10) 
pars_type2 = c(2.28,0.55,Inf,0.004,1.10) 

island_replicates_2types = DAISIE_sim( 
  time = 4, 
  M = 1000, 
  pars = c(pars_type1,pars_type2), 
  replicates = 100, 
  prop_type2_pool = 0.163
) 
```                

This produces a figure similar to Fig. 2, with three plots: 
one for the total number of species,  one for species of type 1 and one for species of type 2. Accessing each island replicate 
 individually (e.g. island_replicates_2types[[15]]) shows information on branching times and 
 species-through-time tables for total, type 1 species and type 2 species.